<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Sage Shooting â€” Mobile + Desktop</title>
<style>
  :root { --accent:#ffcc00; --text:#e9eef5; }
  *{ box-sizing:border-box; touch-action:none; }
  html,body{ height:100%; margin:0; background:#0e0f12; color:var(--text);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  .wrap{ position:relative; width:100%; height:100%; display:flex; align-items:center; justify-content:center; overflow:hidden; }
  canvas{ width:100vw; height:100vh; background:#30343b; display:block; }
  .hud{ position:absolute; top:8px; left:8px; right:8px; display:flex; justify-content:space-between; gap:8px;
        font-weight:700; text-shadow:0 2px 2px rgba(0,0,0,.4); font-size:14px; pointer-events:none; }
  .pill{ background:rgba(0,0,0,.35); padding:6px 10px; border-radius:999px; }
  .overlay, .tapstart {
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:14px;
    background:rgba(0,0,0,.6); text-align:center; padding:24px;
  }
  .overlay{ display:none; }
  .overlay.show{ display:flex; }
  h1{ margin:.2em 0; font-size: clamp(20px, 4vw, 32px); }
  button{
    background:var(--accent); color:#111; border:none; border-radius:12px; padding:12px 18px; font-weight:800; letter-spacing:.2px;
    box-shadow:0 6px 24px rgba(0,0,0,.35); cursor:pointer;
  }
  .crosshair{
    position:absolute; width:28px; height:28px; pointer-events:none; transform:translate(-50%,-50%);
  }
  .crosshair:before, .crosshair:after{
    content:""; position:absolute; left:13px; top:0; bottom:0; width:2px; background:#ffd84d;
  }
  .crosshair:after{ left:0; right:0; top:13px; height:2px; width:auto; }
  .dot{ position:absolute; left:13px; top:13px; width:2px; height:2px; background:#ffd84d; }
</style>
</head>
<body>
<div class="wrap">
  <canvas id="game"></canvas>
  <div class="crosshair" id="xh"><div class="dot"></div></div>

  <div class="hud">
    <div class="pill">Score: <span id="score">0</span></div>
    <div class="pill">Active: <span id="active">10</span>/10</div>
    <div class="pill">Goal: clear all before any respawn</div>
  </div>

  <div id="tapstart" class="tapstart">
    <h1>Tap to Start</h1>
    <div>Move your finger (or mouse) to aim â€¢ Tap/Click to shoot</div>
    <button id="startBtn">Start</button>
  </div>

  <div id="overlay" class="overlay">
    <h1 id="message">ISE O KALLITEROS TZINIOS POU KSERO ðŸŽ‰</h1>
    <button id="restart">Play again</button>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d', { alpha: false });
  const overlay = document.getElementById('overlay');
  const message = document.getElementById('message');
  const restartBtn = document.getElementById('restart');
  const scoreEl = document.getElementById('score');
  const activeEl = document.getElementById('active');
  const tapstart = document.getElementById('tapstart');
  const startBtn = document.getElementById('startBtn');
  const crosshair = document.getElementById('xh');

  function fitCanvas(){
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const w = Math.floor(window.innerWidth * dpr);
    const h = Math.floor(window.innerHeight * dpr);
    canvas.width = w;
    canvas.height = h;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    FLOOR_Y = canvas.height - Math.max(140*dpr, Math.min(220*dpr, canvas.height*0.18));
  }
  window.addEventListener('resize', fitCanvas);
  fitCanvas();

  const RESPAWN_MS = 7000; 
  const BOTTLE_COUNT = 10;
  const BOTTLE_R = 22;    
  const HIT_R = 28;       

  let FLOOR_Y = canvas.height - 180;
  let bottles = [];
  let score = 0;
  let gameWon = false;
  let startedAudio = false;
  let mouse = { x: canvas.width/2, y: canvas.height/2 };

  const audio = {
    ctx: null, master: null,
    start() {
      if (this.ctx) return;
      const AC = window.AudioContext || window.webkitAudioContext;
      this.ctx = new AC();
      this.master = this.ctx.createGain();
      this.master.gain.value = 0.25;
      this.master.connect(this.ctx.destination);
      const o1 = this.ctx.createOscillator();
      const o2 = this.ctx.createOscillator();
      o1.type='sawtooth'; o2.type='sawtooth';
      o1.frequency.value=110; o2.frequency.value=110*Math.pow(2,3/12);
      const lp = this.ctx.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=320;
      const g  = this.ctx.createGain(); g.gain.value=0.08;
      o1.connect(lp); o2.connect(lp); lp.connect(g); g.connect(this.master);
      o1.start(); o2.start();
    },
    gunshot(){
      if (!this.ctx) return;
      const t = this.ctx.currentTime;
      const bufferSize = this.ctx.sampleRate*0.07;
      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0;i<buffer.length;i++) data[i]=(Math.random()*2-1)*(1-i/buffer.length);
      const noise = this.ctx.createBufferSource(); noise.buffer = buffer;
      const ng = this.ctx.createGain(); ng.gain.setValueAtTime(0.6,t); ng.gain.exponentialRampToValueAtTime(0.001,t+0.07);
      const hp = this.ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1000;
      noise.connect(hp); hp.connect(ng); ng.connect(this.master); noise.start();
    },
    glass(){
      if (!this.ctx) return;
      const t=this.ctx.currentTime;
      const o=this.ctx.createOscillator(); const g=this.ctx.createGain();
      o.type='square'; o.frequency.setValueAtTime(1600,t); o.frequency.exponentialRampToValueAtTime(900,t+0.09);
      g.gain.setValueAtTime(0.15,t); g.gain.exponentialRampToValueAtTime(0.0001,t+0.09);
      o.connect(g); g.connect(this.master); o.start(t); o.stop(t+0.1);
    }
  };

  const rand = (min,max)=> Math.random()*(max-min)+min;
  const dist = (a,b,x,y)=> Math.hypot(a-x, b-y);

  function spawnBottle(){
    let tries = 0;
    while (tries++ < 300){
      const x = rand(60, canvas.width-60);
      const y = rand(140, FLOOR_Y-20);
      let ok = true;
      for (const b of bottles){
        if (b.active && dist(x,y,b.x,b.y) < BOTTLE_R*2.4){ ok=false; break; }
      }
      if (ok) return {x,y,active:true,respawnAt:0};
    }
    return {x:canvas.width*0.5, y:canvas.height*0.5, active:true, respawnAt:0};
  }

  function resetGame(){
    score = 0; gameWon = false;
    bottles.length = 0;
    for (let i=0;i<BOTTLE_COUNT;i++) bottles.push(spawnBottle());
    overlay.classList.remove('show');
    updateHUD();
  }

  function updateHUD(){
    const active = bottles.filter(b=>b.active).length;
    scoreEl.textContent = String(score);
    activeEl.textContent = String(active);
  }

  function drawGarage(){
    const g = ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,'#3a414a'); g.addColorStop(1,'#24292f');
    ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#2a2f35';
    ctx.fillRect(0, FLOOR_Y, canvas.width, canvas.height-FLOOR_Y);
    ctx.fillStyle = '#2f353d';
    const count = Math.floor(canvas.width/180);
    for (let i=0;i<count;i++){
      const x = 60 + i*180;
      ctx.fillRect(x, 0, 18, FLOOR_Y);
    }
    const rad = ctx.createRadialGradient(canvas.width/2, canvas.height*0.4, 60, canvas.width/2, canvas.height*0.65, Math.max(canvas.width,canvas.height)*0.7);
    rad.addColorStop(0,'rgba(0,0,0,0)'); rad.addColorStop(1,'rgba(0,0,0,0.55)');
    ctx.fillStyle = rad; ctx.fillRect(0,0,canvas.width,canvas.height);
    const sx = canvas.width/2 - 50, sy = FLOOR_Y - 20;
    ctx.fillStyle = '#171a1f'; ctx.fillRect(sx, sy-50, 100, 50);
    ctx.fillStyle = '#1d2026'; ctx.beginPath(); ctx.arc(canvas.width/2, sy-70, 18, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#14171c'; ctx.fillRect(canvas.width/2+25, sy-60, 60, 8);
  }

  function drawBottle(b){
    const x=b.x, y=b.y;
    ctx.save();
    ctx.translate(x,y);
    ctx.shadowColor='rgba(0,0,0,.45)'; ctx.shadowBlur=10; ctx.shadowOffsetY=5;
    const grad = ctx.createLinearGradient(0, -BOTTLE_R-28, 0, BOTTLE_R+16);
    grad.addColorStop(0,  '#8ec6ff');
    grad.addColorStop(0.6,'#3aa0ff');
    grad.addColorStop(1,  '#0a85ff');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.moveTo(-9, -BOTTLE_R-30);
    ctx.lineTo( 9, -BOTTLE_R-30);
    ctx.lineTo( 9, -BOTTLE_R-10);
    ctx.quadraticCurveTo( 12, -BOTTLE_R,  14, -BOTTLE_R+6);
    ctx.quadraticCurveTo( 18,  -8,  16,  12);
    ctx.quadraticCurveTo( 14,  24,   0,  28);
    ctx.quadraticCurveTo(-14,  24, -16,  12);
    ctx.quadraticCurveTo(-18,  -8, -14, -BOTTLE_R+6);
    ctx.quadraticCurveTo(-12, -BOTTLE_R, -9, -BOTTLE_R-10);
    ctx.closePath();
    ctx.fill();
    ctx.globalAlpha = 0.22;
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.ellipse(-8, -6, 10, 16, -0.4, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;
    ctx.fillStyle = '#6fa9f7';
    ctx.fillRect(-11, -BOTTLE_R-34, 22, 4);
    ctx.restore();
  }

  function drawCrosshair(){
    const rect = canvas.getBoundingClientRect();
    crosshair.style.left = (mouse.x / canvas.width * rect.width) + 'px';
    crosshair.style.top  = (mouse.y / canvas.height * rect.height) + 'px';
  }

  function update(now){
    let activeCount = 0;
    for (const b of bottles){
      if (!b.active && now >= b.respawnAt){
        const nb = spawnBottle();
        b.x=nb.x; b.y=nb.y; b.active=true; b.respawnAt=0;
      }
      if (b.active) activeCount++;
    }
    if (!gameWon && activeCount===0){
      gameWon = true;
      message.textContent = "ISE O KALLITEROS TZINIOS POU KSERO ðŸŽ‰";
      overlay.classList.add('show');
    }
    updateHUD();
  }

  function render(){
    drawGarage();
    for (const b of bottles) if (b.active) drawBottle(b);
  }

  function loop(now){
    update(now);
    render();
    drawCrosshair();
    requestAnimationFrame(loop);
  }

  function screenToCanvas(px, py){
    const rect = canvas.getBoundingClientRect();
    const x = (px - rect.left) * (canvas.width / rect.width);
    const y = (py - rect.top) * (canvas.height / rect.height);
    return {x, y};
  }

  function aimAt(clientX, clientY){
    const p = screenToCanvas(clientX, clientY);
    mouse.x = p.x; mouse.y = p.y;
  }

  window.addEventListener('pointermove', (e)=>{
    aimAt(e.clientX, e.clientY);
  }, {passive:false});

  window.addEventListener('pointerdown', (e)=>{
    if (!startedAudio){ audio.start(); startedAudio=true; }
    if (tapstart) tapstart.style.display='none';
    if (gameWon) return;
    audio.gunshot();
    let hitIndex = -1, hitDist = Infinity;
    for (let i=0;i<bottles.length;i++){
      const b = bottles[i]; if (!b.active) continue;
      const d = Math.hypot(mouse.x - b.x, mouse.y - b.y);
      if (d < HIT_R && d < hitDist){ hitDist=d; hitIndex=i; }
    }
    if (hitIndex>=0){
      const b = bottles[hitIndex];
      b.active = false;
      b.respawnAt = performance.now() + RESPAWN_MS; 
      score += 10;
      audio.glass();
      updateHUD();
    }
  }, {passive:false});

  restartBtn.addEventListener('click', ()=>{
    resetGame();
    overlay.classList.remove('show');
  });

  startBtn.addEventListener('click', ()=>{
    if (!startedAudio){ audio.start(); startedAudio=true; }
    tapstart.style.display='none';
  });

  resetGame();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>