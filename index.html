<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Sage Shooting â€” Mobile Friendly (5s Respawn, Real Bottles)</title>
<style>
  :root { --accent:#ffcc00; --text:#e9eef5; }
  *{box-sizing:border-box; touch-action:none;}
  html,body{height:100%; margin:0; background:#0e0f12; color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  .wrap{ position:relative; width:100%; height:100%; display:flex; align-items:center; justify-content:center; }
  canvas{ width:100vw; height:100vh; background:#30343b; display:block; }
  .hud{ position:absolute; top:8px; left:8px; right:8px; display:flex; justify-content:space-between; gap:8px; font-weight:700; text-shadow:0 2px 2px rgba(0,0,0,.4); font-size:14px; }
  .pill{ background:rgba(0,0,0,.35); padding:6px 10px; border-radius:999px; }
  .overlay, .tapstart {
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:14px;
    background:rgba(0,0,0,.6); text-align:center; padding:24px;
  }
  .overlay{ display:none; }
  .overlay.show{ display:flex; }
  h1{ margin:.2em 0; font-size: clamp(20px, 5vw, 36px); }
  button{
    background:var(--accent); color:#111; border:none; border-radius:12px; padding:12px 18px; font-weight:800; letter-spacing:.2px;
    box-shadow:0 6px 24px rgba(0,0,0,.35);
  }
  .crosshair{
    position:absolute; width:28px; height:28px; pointer-events:none; transform:translate(-50%,-50%);
  }
  .crosshair:before, .crosshair:after{
    content:""; position:absolute; left:13px; top:0; bottom:0; width:2px; background:#ffd84d;
  }
  .crosshair:after{ left:0; right:0; top:13px; height:2px; width:auto; }
  .dot{ position:absolute; left:13px; top:13px; width:2px; height:2px; background:#ffd84d; }
</style>
</head>
<body>
<div class="wrap">
  <canvas id="game" width="720" height="1280"></canvas>
  <div class="crosshair" id="xh"><div class="dot"></div></div>
  <div class="hud">
    <div class="pill">Score: <span id="score">0</span></div>
    <div class="pill">Active: <span id="active">10</span>/10</div>
    <div class="pill">Goal: clear all before any respawn (5s)</div>
  </div>
  <div id="tapstart" class="tapstart">
    <h1>Tap to Start</h1>
    <div>Move your finger to aim â€¢ Tap to shoot</div>
    <button id="startBtn">Start</button>
  </div>
  <div id="overlay" class="overlay">
    <h1 id="message">ISE O KALLITEROS TZINIOS POU KSERO ðŸŽ‰</h1>
    <button id="restart">Play again</button>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const overlay = document.getElementById('overlay');
  const message = document.getElementById('message');
  const restartBtn = document.getElementById('restart');
  const scoreEl = document.getElementById('score');
  const activeEl = document.getElementById('active');
  const tapstart = document.getElementById('tapstart');
  const startBtn = document.getElementById('startBtn');
  const crosshair = document.getElementById('xh');

  // Fit canvas to device pixels
  function fitCanvas(){
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const w = Math.floor(window.innerWidth * dpr);
    const h = Math.floor(window.innerHeight * dpr);
    canvas.width = w;
    canvas.height = h;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
  }
  fitCanvas();
  window.addEventListener('resize', fitCanvas);

  // ---- Config (updated) ----
  const RESPAWN_MS = 5000; // 5 seconds (harder)
  const BOTTLE_COUNT = 10;
  const HIT_R = 28; // hit radius around bottle center
  let FLOOR_Y = canvas.height - 180;

  // State
  let bottles = [];
  let score = 0;
  let gameWon = false;
  let startedAudio = false;
  let mouse = { x: canvas.width/2, y: canvas.height/2 };

  // Audio (WebAudio, generated â€” no external files)
  const audio = {
    ctx: null, master: null,
    start() {
      if (this.ctx) return;
      const AC = window.AudioContext || window.webkitAudioContext;
      this.ctx = new AC();
      this.master = this.ctx.createGain();
      this.master.gain.value = 0.25;
      this.master.connect(this.ctx.destination);
      // Simple ambient pad
      const mkPad = (freq, gain=0.06) => {
        const o=this.ctx.createOscillator(); o.type='sawtooth'; o.frequency.value=freq;
        const lp=this.ctx.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=300;
        const g=this.ctx.createGain(); g.gain.value=gain;
        o.connect(lp); lp.connect(g); g.connect(this.master); o.start();
      };
      mkPad(110); mkPad(110*Math.pow(2,3/12), 0.05);
    },
    gunshot(){
      if (!this.ctx) return;
      const t=this.ctx.currentTime;
      // noise pop
      const nbuf = this.ctx.createBuffer(1, this.ctx.sampleRate*0.06, this.ctx.sampleRate);
      const data = nbuf.getChannelData(0);
      for (let i=0;i<data.length;i++) data[i]=(Math.random()*2-1)*(1-i/data.length);
      const src=this.ctx.createBufferSource(); src.buffer=nbuf;
      const g=this.ctx.createGain(); g.gain.setValueAtTime(0.7,t); g.gain.exponentialRampToValueAtTime(0.001,t+0.06);
      const hp=this.ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1100;
      src.connect(hp); hp.connect(g); g.connect(this.master); src.start();
    },
    glass(){
      if (!this.ctx) return;
      const t=this.ctx.currentTime;
      const o=this.ctx.createOscillator(); o.type='square';
      const g=this.ctx.createGain();
      o.frequency.setValueAtTime(1700,t); o.frequency.exponentialRampToValueAtTime(950,t+0.09);
      g.gain.setValueAtTime(0.18,t); g.gain.exponentialRampToValueAtTime(0.0001,t+0.09);
      o.connect(g); g.connect(this.master); o.start(t); o.stop(t+0.1);
    }
  };

  function rand(min,max){ return Math.random()*(max-min)+min; }

  // Spawn bottles with spacing
  function spawnBottle(existing){
    let tries=0;
    while (tries++<300){
      const x=rand(60, canvas.width-60);
      const y=rand(140, FLOOR_Y-20);
      let ok=true;
      for (const b of existing){
        if (b.active){
          const dx=x-b.x, dy=y-b.y;
          if (Math.hypot(dx,dy) < 64){ ok=false; break; }
        }
      }
      if (ok) return {x,y,active:true,respawnAt:0};
    }
    return {x:canvas.width*0.5,y:canvas.height*0.5,active:true,respawnAt:0};
  }

  function resetGame(){
    score=0; gameWon=false;
    bottles.length=0;
    FLOOR_Y = canvas.height - Math.max(140, Math.min(220, canvas.height*0.18));
    for (let i=0;i<BOTTLE_COUNT;i++) bottles.push(spawnBottle(bottles));
    overlay.classList.remove('show');
    updateHUD();
  }

  function updateHUD(){
    const active=bottles.filter(b=>b.active).length;
    scoreEl.textContent = String(score);
    activeEl.textContent = String(active);
  }

  // Garage background (drawn)
  function drawGarage(){
    const g=ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,'#3a414a'); g.addColorStop(1,'#24292f');
    ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#2a2f35'; ctx.fillRect(0,FLOOR_Y,canvas.width,canvas.height-FLOOR_Y);
    ctx.fillStyle='#2f353d';
    const count = Math.floor(canvas.width/180);
    for (let i=0;i<count;i++){
      const x=60+i*180; ctx.fillRect(x,0,18,FLOOR_Y);
    }
    const rad=ctx.createRadialGradient(canvas.width/2, canvas.height*0.4, 60, canvas.width/2, canvas.height*0.65, Math.max(canvas.width,canvas.height)*0.7);
    rad.addColorStop(0,'rgba(0,0,0,0)'); rad.addColorStop(1,'rgba(0,0,0,0.55)');
    ctx.fillStyle=rad; ctx.fillRect(0,0,canvas.width,canvas.height);
    // Soldier silhouette
    const sx=canvas.width/2-50, sy=FLOOR_Y-20;
    ctx.fillStyle='#171a1f'; ctx.fillRect(sx, sy-50, 100, 50);
    ctx.fillStyle='#1d2026'; ctx.beginPath(); ctx.arc(canvas.width/2, sy-70, 18, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle='#14171c'; ctx.fillRect(canvas.width/2+25, sy-60, 60, 8);
  }

  // Draw a more realistic bottle silhouette (vector path)
  function drawBottle(b){
    const x=b.x, y=b.y;
    ctx.save();
    ctx.translate(x,y);
    ctx.shadowColor='rgba(0,0,0,.45)'; ctx.shadowBlur=10; ctx.shadowOffsetY=5;

    // Bottle dimensions
    const H = 74;   // total height
    const W = 30;   // body width
    const neckW = 14;
    const neckH = 18;
    const shoulderH = 10;
    const bodyH = H - neckH - shoulderH - 8; // minus base radius
    const baseR = 10;

    // Glass gradient
    const grad = ctx.createLinearGradient(0, -H/2, 0, H/2);
    grad.addColorStop(0, '#bfe0ff');
    grad.addColorStop(0.55, '#7fb7ff');
    grad.addColorStop(1, '#0a85ff');

    ctx.fillStyle = grad;
    ctx.strokeStyle = 'rgba(255,255,255,0.35)';
    ctx.lineWidth = 1.2;

    ctx.beginPath();
    // Start at neck top-left
    ctx.moveTo(-neckW/2, -H/2);
    ctx.lineTo(neckW/2, -H/2);
    ctx.lineTo(neckW/2, -H/2 + neckH);
    // shoulders outwards
    ctx.quadraticCurveTo(neckW/2, -H/2 + neckH + shoulderH*0.3, W/2, -H/2 + neckH + shoulderH);
    // down right body
    ctx.lineTo(W/2, -H/2 + neckH + shoulderH + bodyH - baseR);
    // base right arc
    ctx.quadraticCurveTo(W/2, -H/2 + neckH + shoulderH + bodyH, W/2 - baseR, -H/2 + neckH + shoulderH + bodyH);
    // bottom arc to left
    ctx.lineTo(-W/2 + baseR, -H/2 + neckH + shoulderH + bodyH);
    ctx.quadraticCurveTo(-W/2, -H/2 + neckH + shoulderH + bodyH, -W/2, -H/2 + neckH + shoulderH + bodyH - baseR);
    // up left body
    ctx.lineTo(-W/2, -H/2 + neckH + shoulderH);
    // shoulders inwards
    ctx.quadraticCurveTo(-neckW/2, -H/2 + neckH + shoulderH*0.3, -neckW/2, -H/2 + neckH);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    // neck highlight
    ctx.globalAlpha = 0.16;
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(-neckW/2 + 1.5, -H/2 + 2, 3, neckH-4);
    ctx.globalAlpha = 1;

    // subtle specular
    ctx.globalAlpha = 0.18;
    ctx.beginPath();
    ctx.ellipse(-W*0.22, -H*0.05, 6, 16, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;

    ctx.restore();
  }

  function drawCrosshair(){
    crosshair.style.left = (mouse.x / (canvas.width) * window.innerWidth) + 'px';
    crosshair.style.top  = (mouse.y / (canvas.height) * window.innerHeight) + 'px';
  }

  function update(now){
    let activeCount=0;
    for (const b of bottles){
      if (!b.active && now >= b.respawnAt){
        const nb = spawnBottle(bottles);
        b.x=nb.x; b.y=nb.y; b.active=true; b.respawnAt=0;
      }
      if (b.active) activeCount++;
    }
    if (!gameWon && activeCount===0){
      gameWon=true;
      // Custom win text provided by you:
      message.textContent = "ISE O KALLITEROS TZINIOS POU KSERO ðŸŽ‰";
      overlay.classList.add('show');
    }
    updateHUD();
  }

  function render(){
    drawGarage();
    for (const b of bottles) if (b.active) drawBottle(b);
  }

  let last = performance.now();
  function loop(now){
    render();
    update(now);
    drawCrosshair();
    requestAnimationFrame(loop);
  }

  function screenToCanvas(px, py){
    const rect = canvas.getBoundingClientRect();
    const x = (px - rect.left) * (canvas.width / rect.width);
    const y = (py - rect.top) * (canvas.height / rect.height);
    return {x, y};
  }

  // Pointer (touch/mouse) support
  function aimAt(clientX, clientY){
    const p = screenToCanvas(clientX, clientY);
    mouse.x = p.x; mouse.y = p.y;
  }

  window.addEventListener('pointermove', (e)=>{
    aimAt(e.clientX, e.clientY);
  }, {passive:false});

  window.addEventListener('pointerdown', (e)=>{
    if (!startedAudio){ audio.start(); startedAudio=true; }
    if (tapstart) tapstart.style.display='none';
    if (gameWon) return;
    audio.gunshot();
    // hit test
    let hitIndex=-1, hitDist=Infinity;
    for (let i=0;i<bottles.length;i++){
      const b=bottles[i]; if (!b.active) continue;
      const d = Math.hypot(mouse.x - b.x, mouse.y - b.y);
      if (d < HIT_R && d < hitDist){ hitDist=d; hitIndex=i; }
    }
    if (hitIndex>=0){
      const b=bottles[hitIndex];
      b.active=false; b.respawnAt=performance.now()+RESPAWN_MS;
      score+=10; audio.glass(); updateHUD();
    }
  }, {passive:false});

  restartBtn.addEventListener('click', ()=>{
    resetGame();
    overlay.classList.remove('show');
  });

  startBtn.addEventListener('click', ()=>{
    if (!startedAudio){ audio.start(); startedAudio=true; }
    tapstart.style.display='none';
  });

  resetGame();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
